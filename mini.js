async function fetchDataAndSplit(){const e={reportType:1,from:"2024-01-25"},t=new URL("https://idp.mymarkers.io/api/kenku/dailyglucosereport");Object.keys(e).forEach((a=>t.searchParams.append(a,e[a])));try{const e=await fetch(t,{method:"GET",headers:{Accept:"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const a=await e.json(),r=(a.type,a.overall);a.parameters,a.lineData;updateOverallScore(r.score),renderParameterCards(a.parameters),renderChart(a.lineData)}catch(e){}}function updateOverallScore(e){document.querySelectorAll('[apiData="ChartResultDailyScore"]').forEach((t=>{t.textContent=e}))}function renderParameterCards(e){const t=document.querySelector('[apiData="parameterContainer"]'),a=document.querySelector('[apiData="recapParameterCard"]'),r=t.querySelector('[apiData="recapOverall"]');t&&a&&(a.style.display="none",Array.from(t.children).forEach((e=>{e!==a&&e!==r&&e.remove()})),e.forEach((e=>{if(null===e.name&&null===e.subTitle||!e.values||0===e.values.length||e.values.some((e=>null===e.val)))return;const r=a.cloneNode(!0);r.style.display="";const o=r.querySelector('[apiData="recapParameterTitle"]'),n=r.querySelector('[apiData="recapParameterResult"]'),l=r.querySelector('[apiData="recapParameterSubResult"]'),i=e.values[0].val;o&&(o.textContent=e.name||"No Title"),n&&(n.textContent=String(i)),l&&(l.textContent=e.subTitle||"No Subtitle"),r.removeAttribute("apiData"),t.appendChild(r)})))}function renderChart(e){const t=e.filter((e=>null!==e.GCV&&null!==e.S1&&null!==e.S2)),a=t.map((e=>e.datetime)),r=t.map((e=>e.GCV)),o=t.map((e=>e.S1)),n=t.map((e=>e.S2)),l=Math.min(...o),i=Math.max(...n),s=r.map((e=>e<l||e>i?"red":"green")),c=document.getElementById("chart-canvas");new Chart(c,{type:"line",data:{labels:a,datasets:[{label:"GCV",data:r,fill:!1,borderColor:s,segment:{borderColor:function(e){const t=e.p1.parsed.y;return t>=i||t<=l?"red":t<i||t>l?"green":"gray"}},backgroundColor:s,borderWidth:1,tension:.1,pointRadius:0}]},options:{scales:{x:{type:"time",time:{parser:"YYYY-MM-DD HH:mm:ss",tooltipFormat:"ll HH:mm",unit:"hour",displayFormats:{hour:"D MMM YYYY, hA"}},ticks:{source:"auto",maxRotation:0,autoSkip:!0,maxTicksLimit:24}},y:{beginAtZero:!0,min:0,max:200,ticks:{stepSize:50}}},plugins:{annotation:{annotations:{lineLow:{type:"line",yMin:l,yMax:l,borderColor:"grey",borderWidth:1,label:{content:`Low threshold (${l})`,enabled:!0,position:"start"}},lineHigh:{type:"line",yMin:i,yMax:i,borderColor:"grey",borderWidth:1,label:{content:`High threshold (${i})`,enabled:!0,position:"start"}}}},zoom:{pan:{enabled:!0,mode:"xy"},zoom:{wheel:{enabled:!0,speed:.25},mode:"xy",limits:{y:{min:300,max:50}}}}}}})}fetchDataAndSplit();